{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "BlockPMP",
      "Effect": "Deny",
      "Action": [
        "aws-marketplace:CreatePrivateMarketplace",
        "aws-marketplace:AssociateProductsWithPrivateMarketplace",
        "aws-marketplace:CreatePrivateMarketplaceProfile",
        "aws-marketplace:DescribePrivateMarketplaceProducts",
        "aws-marketplace:DescribePrivateMarketplaceProfile",
        "aws-marketplace:DescribePrivateMarketplaceStatus",
        "aws-marketplace:DisassociateProductsFromPrivateMarketplace",
        "aws-marketplace:ListPrivateMarketplaceProducts",
        "aws-marketplace:StartPrivateMarketplace",
        "aws-marketplace:StopPrivateMarketplace",
        "aws-marketplace:UpdatePrivateMarketplaceProfile"
      ],
      "Resource": "*",
      "Condition": {}
    },
    {
      "Sid": "DenyRoot",
      "Effect": "Deny",
      "NotAction": [
        "iam:CreateVirtualMFADevice",
        "iam:EnableMFADevice",
        "iam:GetUser",
        "iam:ListMFADevices",
        "iam:ListVirtualMFADevices",
        "iam:ResyncMFADevice",
        "sts:GetSessionToken"
      ],
      "Resource": "*",
      "Condition": {
        "ArnLike": {
          "aws:PrincipalARN": ["arn:aws:iam::*:root"]
        }
      }
    },
    {
      "Sid": "EbsEncrypt1",
      "Effect": "Deny",
      "Action": "ec2:RunInstances",
      "Resource": "arn:aws:ec2:*:*:volume/*",
      "Condition": {
        "Bool": {
          "ec2:Encrypted": "false"
        }
      }
    },
    {
      "Sid": "EBSEncrypt2",
      "Effect": "Deny",
      "Action": "ec2:CreateVolume",
      "Resource": "*",
      "Condition": {
        "Bool": {
          "ec2:Encrypted": "false"
        }
      }
    },
    {
      "Sid": "EFSEncrypt",
      "Effect": "Deny",
      "Action": "elasticfilesystem:CreateFileSystem",
      "Resource": "*",
      "Condition": {
        "Bool": {
          "elasticfilesystem:Encrypted": "false"
        }
      }
    },
    {
      "Sid": "RdsEncrypt",
      "Effect": "Deny",
      "Action": "rds:CreateDBInstance",
      "Resource": "arn:aws:rds:*:*:db:*",
      "Condition": {
        "StringNotLike": {
          "rds:DatabaseEngine": "aurora*"
        },
        "Bool": {
          "rds:StorageEncrypted": "false"
        }
      }
    },
    {
      "Sid": "AuroraEncrypt",
      "Effect": "Deny",
      "Action": "rds:CreateDBCluster",
      "Resource": "*",
      "Condition": {
        "StringLike": {
          "rds:DatabaseEngine": "aurora*"
        },
        "Bool": {
          "rds:StorageEncrypted": "false"
        }
      }
    },
    {
      "Action": ["ssm:CreateDocument", "ssm:UpdateDocument", "ssm:DeleteDocument"],
      "Effect": "Deny",
      "Resource": ["arn:aws:ssm:::document/SSM-SessionManagerRunShell"],
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/AWSCloudFormationStackSetExecutionRole",
            "arn:aws:iam::*:role/PBMMAccel-*"
          ]
        }
      }
    },
    {
      "Effect": "Deny",
      "Action": ["kms:DeleteAlias", "kms:UpdateAlias", "kms:DisableKey", "kms:ImportKeyMaterial", "kms:PutKeyPolicy"],
      "Resource": "arn:aws:kms:::alias/PBMMAccel*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/AWSCloudFormationStackSetExecutionRole",
            "arn:aws:iam::*:role/PBMMAccel-*"
          ]
        }
      }
    },
    {
      "Sid": "DenyRDGWRole",
      "Effect": "Deny",
      "Action": ["iam:*"],
      "Resource": "arn:aws:iam::*:role/PBMMAccel-RDGW-Role",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/AWSCloudFormationStackSetExecutionRole",
            "arn:aws:iam::*:role/PBMMAccel-*"
          ]
        }
      }
    },
    {
      "Sid": "DenyLog2",
      "Effect": "Deny",
      "Action": ["logs:AssociateKmsKey", "logs:DisassociateKmsKey", "logs:PutDestination", "logs:PutDestinationPolicy"],
      "Resource": "arn:aws:logs:::log-group:*PBMMAccel*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/AWSCloudFormationStackSetExecutionRole",
            "arn:aws:iam::*:role/PBMMAccel-*"
          ]
        }
      }
    },
    {
      "Sid": "DenyPolicy",
      "Effect": "Deny",
      "Action": [
        "iam:CreatePolicy",
        "iam:DeletePolicy",
        "iam:DeletePolicyVersion",
        "iam:SetDefaultPolicyVersion",
        "iam:CreatePolicyVersion"
      ],
      "Resource": "arn:aws:iam::*:policy/PBMMAccel-*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/AWSCloudFormationStackSetExecutionRole",
            "arn:aws:iam::*:role/PBMMAccel-*"
          ]
        }
      }
    },
    {
      "Sid": "DenySecurity",
      "Effect": "Deny",
      "Action": [
        "guardduty:AcceptInvitation",
        "guardduty:DeclineInvitations",
        "guardduty:DeleteDetector",
        "guardduty:DeleteInvitations",
        "guardduty:DeleteMembers",
        "guardduty:DeletePublishingDestination",
        "guardduty:DisassociateFromMasterAccount",
        "guardduty:DisassociateMembers",
        "guardduty:StopMonitoringMembers",
        "guardduty:UpdateDetector",
        "guardduty:UpdateFindingsFeedback",
        "guardduty:UpdatePublishingDestination",
        "guardduty:UpdateOrganizationConfiguration",
        "guardduty:DisableOrganizationAdminAccount",
        "guardduty:CreateMembers",
        "guardduty:InviteMembers",
        "securityhub:AcceptInvitation",
        "securityhub:DeclineInvitations",
        "securityhub:DeleteInvitations",
        "securityhub:DeleteMembers",
        "securityhub:InviteMembers",
        "securityhub:CreateMembers",
        "securityhub:DisableSecurityHub",
        "securityhub:DisassociateFromMasterAccount",
        "securityhub:DeleteInsight",
        "securityhub:DisassociateMembers",
        "securityhub:DeleteActionTarget",
        "securityhub:BatchDisableStandards",
        "securityhub:UpdateSecurityHubConfiguration",
        "securityhub:UpdateStandardsControl",
        "macie2:AcceptInvitation",
        "macie2:CreateInvitations",
        "macie2:CreateMember",
        "macie2:DeclineInvitations",
        "macie2:DeleteInvitations",
        "macie2:DeleteMember",
        "macie2:DisableMacie",
        "macie2:DisableOrganizationAdminAccount",
        "macie2:DisassociateFromMasterAccount",
        "macie2:DisassociateMember",
        "macie2:EnableMacie",
        "macie2:EnableOrganizationAdminAccount",
        "macie2:UpdateMacieSession",
        "macie2:UpdateMemberSession",
        "macie2:UpdateOrganizationConfiguration",
        "fms:DisassociateAdminAccount",
        "access-analyzer:DeleteAnalyzer",
        "account:EnableRegion",
        "account:DisableRegion",
        "ec2:CreateDefaultVpc"
      ],
      "Resource": "*",
      "Condition": {
        "ArnNotLike": {
          "aws:PrincipalARN": [
            "arn:aws:iam::*:role/AWSCloudFormationStackSetExecutionRole",
            "arn:aws:iam::*:role/PBMMAccel-*"
          ]
        }
      }
    }
  ]
}
